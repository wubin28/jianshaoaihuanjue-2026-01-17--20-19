## Me:

```
你是spec-kit框架的专家，我是spec-kit的新手。请你阅读当前项目的 @.specify/ 和 @.claude/ 目录下的脚本和markdown文件，然后解释下面的speckit命令是如何通过这些脚本和markdown起作用的，以便当这些命令的行为需要调整时，我能知道如何操作。下面是我关注的5个命令：【
/speckit.constitution Create principles focused on code quality, testing standards, user experience consistency, and performance requirements
/speckit.specify Build an application that can help me organize my photos in separate photo albums. Albums are grouped by date and can be re-organized by dragging and dropping on the main page. Albums are never in other nested albums. Within each album, photos are previewed in a tile-like interface.
/speckit.plan The application uses Vite with minimal number of libraries. Use vanilla HTML, CSS, and JavaScript as much as possible. Images are not uploaded anywhere and metadata is stored in a local SQLite database.
/speckit.tasks
/speckit.implement
】。我想通过理解底层脚本和模板的工作机制，来掌握如何调整这些命令的行为以满足我的项目需求。输出格式为markdown。我担心你给出的解释可能不准确。
请严格按照以下工作流程完成我的诉求：
【## 背景说明

你是一个AI智能体工具。由于你的高级能力，你往往过于急切，经常在没有明确我的诉求时就生成内容（包括代码和非代码内容，下同），假设你比我更了解情况并在生成内容中随意发挥。这会导致我要求你做的工作出现不可接受的错误。在处理我的诉求时，你未经授权的修改可能会引入错误并破坏关键内容。为了防止这种情况，你必须遵循严格的协议。

## 元指令：模式声明要求

**你必须在每个响应开头用括号声明当前模式，没有例外。**
**格式：[MODE: 模式名称]**
**你必须在每个响应结尾明确给出"下一步"提示，让我了解推荐的下一步操作。"下一步"的具体提示信息参见下面各模式的描述。**
**未能声明模式和下一步是对协议的严重违反。**

## RIPER-5 模式

### 模式1：研究

[MODE: RESEARCH]

- **目的**：仅收集信息
- **允许**：读取文件、提出与我的诉求紧密相关的澄清问题、理解内容结构
- **禁止**：建议、实施、规划或任何暗示行动
- **要求**：只能寻求理解现有内容，而非可能的内容
- **持续时间**：直到我明确指示进入下一模式
- **下一步**：完整回复后，在末尾给出推荐操作："1. 输入 'ENTER INNOVATE MODE' 进入下一模式 2. 继续澄清需求，可复制：'进入下一模式前，还有疑问吗？'"
- **输出格式**：以 [MODE: RESEARCH] 开头，然后仅提供观察和问题

### 模式2：创新

[MODE: INNOVATE]

- **目的**：头脑风暴潜在的工作方向
- **允许**：讨论与我的诉求紧密相关的想法、优缺点，征求我的反馈，并针对我之前提到的顾虑提供推荐方向及理由
- **禁止**：具体的技术规划、实施细节或任何代码编写
- **要求**：所有想法必须作为可能性呈现，而非决定
- **持续时间**：直到我明确指示进入下一模式
- **下一步**：若已完整回复本模式，需在回复最后给出推荐操作，如："1. 输入 'ENTER PLAN MODE' 进入下一模式 2. 继续讨论可复制：'我没有看到你针对我的诉求提供的建议方向，请根据我的诉求提供推荐方案及理由。'"
- **输出格式**：以 [MODE: INNOVATE] 开头，然后仅提供可能性和考虑因素

### 模式3：计划

[MODE: PLAN]

- **目的**：创建详尽的工作步骤清单
- **允许**：包含工作所需的全部内容
- **禁止**：任何实施或脚本生成编写，即使是"示例内容"
- **要求**：计划必须足够全面，实施过程中无需创造性决策
- **强制最后步骤**：将计划转为编号清单，每个操作独立。在项目根目录创建 "todo-yyyy-mm-dd--hh-mm.md" 文件，yyyy-mm-dd--hh-mm 为当前时间戳（如："todo-2025-09-30--14-23.md"）
- **清单格式**：

实施清单：
1. [具体操作1]
2. [具体操作2]
...
n. [最终操作]

- **持续时间**：直到我明确批准计划并指示进入下一模式
- **下一步**：完成本模式回复后，需在最后给出推荐操作："1. 进入下一模式：'ENTER EXECUTE MODE' 2. 继续讨论可复制：'请为AI自身制定工作计划，只列清单无需时长预估。将计划转为带编号清单，每项相互独立，创建时间戳文件，重新执行 PLAN 模式。'"
- **输出格式**：以 [MODE: PLAN] 开头，然后仅提供规范和实施细节

### 模式4：执行

[MODE: EXECUTE]

- **目的**：准确实施模式3中的计划
- **允许**：
  - 按照"输出"要求生成工作步骤
  - 逐个处理待办事项，在模式3创建的 todo 文件中标记已完成项目
  - 在每一步给出简短的更改摘要
  - 仅实施批准计划中明确详述的内容
  - 最后在 todo 文件末尾附加审查部分，总结所做更改及相关信息
- **禁止**：任何不在计划中的偏离、改进或创造性添加，任何详细代码示例或系统内部具体实现的规格参数
- **进入要求**：仅在我明确发出 "ENTER EXECUTE MODE" 命令后进入
- **偏离处理**：如果发现任何需要偏离的问题，立即返回计划模式
- **下一步**：完整回复后，在末尾给出推荐操作："1. 'ENTER REVIEW MODE' 进入下一模式 2. 如不满意，可复制粘贴：'请重新执行 EXECUTE MODE。'"
- **输出格式**：以 [MODE: EXECUTE] 开头，然后仅提供与计划匹配的实施

### 模式5：审查

[MODE: REVIEW]

- **目的**：严格验证实施与计划的对照
- **允许**：逐行比较计划和实施
- **必需**：明确标记任何偏离，无论多么微小
- **偏离格式**："⚠️检测到偏离：[偏离的确切描述]"
- **报告**：必须报告实施是否与计划完全相同
- **结论格式**："✅实施与计划完全匹配" 或 "❌实施偏离计划"
- **下一步**：完整回复后，在最后给出推荐操作，如："你已完成一次完整的'暂停并澄清'提示词驱动的工作。此时可重新开启AI会话，进入下一工作过程。"
- **输出格式**：以 [MODE: REVIEW] 开头，然后进行系统比较和明确结论

## 关键协议指南

1. 未经我的明确许可，不能在模式间转换
2. 必须在每个响应开头声明当前模式
3. 在执行模式下，必须100%忠实地遵循计划
4. 在审查模式下，必须标记最小的偏离
5. 没有权限在声明模式外做出独立决策
6. 未能遵循此协议将导致代码库出现灾难性后果

## 模式转换信号

仅当我明确发出以下信号时才转换模式：

- "ENTER RESEARCH MODE"
- "ENTER INNOVATE MODE"
- "ENTER PLAN MODE"
- "ENTER EXECUTE MODE"
- "ENTER REVIEW MODE"

没有这些确切信号，保持当前模式。】。
```

## Claude code with sonnet 4.5

```
● [MODE: RESEARCH]

  我理解您希望深入了解spec-kit框架的工作机制。为了准确解释这5个命令的运作方式，我需要先读取项目中的相关脚本和模板文件。

  让我开始收集信息。

● Search(pattern: "**/.specify/**/*")
  ⎿  Found 11 files (ctrl+o to expand)

● Search(pattern: "**/.claude/**/*")
  ⎿  Found 10 files (ctrl+o to expand)

● Bash(find .specify -type f 2>/dev/null | head -20)
  ⎿  .specify/memory/constitution.md
     .specify/templates/spec-template.md
     .specify/templates/plan-template.md
     … +8 lines (ctrl+o to expand)

● Bash(find .claude -type f 2>/dev/null | head -20)
  ⎿  .claude/commands/speckit.taskstoissues.md
     .claude/commands/speckit.constitution.md
     .claude/commands/speckit.plan.md
     … +6 lines (ctrl+o to expand)

● 现在让我读取您关注的5个命令文件以及相关的模板和脚本。

● Read(.claude/commands/speckit.constitution.md)
  ⎿  Read 83 lines

● Read(.claude/commands/speckit.specify.md)
  ⎿  Read 259 lines

● Read(.claude/commands/speckit.plan.md)
  ⎿  Read 90 lines

● Read(.claude/commands/speckit.tasks.md)
  ⎿  Read 138 lines

● Read(.claude/commands/speckit.implement.md)
  ⎿  Read 136 lines

● 现在让我读取相关的模板文件和脚本，以理解完整的工作流程。

● Read(.specify/templates/spec-template.md)
  ⎿  Read 116 lines

● Read(.specify/templates/plan-template.md)
  ⎿  Read 105 lines

● Read(.specify/templates/tasks-template.md)
  ⎿  Read 252 lines

● Read(.specify/memory/constitution.md)
  ⎿  Read 99 lines

● Read(.specify/scripts/bash/create-new-feature.sh)
  ⎿  Read 298 lines

● Read(.specify/scripts/bash/setup-plan.sh)
  ⎿  Read 62 lines

● 让我继续读取辅助脚本以完整理解工作流程。

● Read(.specify/scripts/bash/common.sh)
  ⎿  Read 157 lines

● Read(.specify/scripts/bash/check-prerequisites.sh)
  ⎿  Read 167 lines

● 观察和信息收集总结

  我已经读取了spec-kit框架的核心文件。以下是我观察到的文件结构和相关内容：

  发现的文件结构

  .claude/commands/ 目录（命令定义文件）：
  - speckit.constitution.md - 项目宪法命令
  - speckit.specify.md - 功能规格说明命令
  - speckit.plan.md - 实施计划命令
  - speckit.tasks.md - 任务生成命令
  - speckit.implement.md - 实施执行命令

  .specify/templates/ 目录（模板文件）：
  - spec-template.md - 功能规格说明模板
  - plan-template.md - 实施计划模板
  - tasks-template.md - 任务列表模板
  - 其他模板文件

  .specify/scripts/bash/ 目录（辅助脚本）：
  - common.sh - 通用函数库
  - create-new-feature.sh - 创建新功能分支和目录
  - setup-plan.sh - 设置计划文件
  - check-prerequisites.sh - 检查前置条件
  - update-agent-context.sh - 更新代理上下文

  .specify/memory/ 目录：
  - constitution.md - 项目宪法（包含代码质量、测试标准、用户体验和性能原则）

  观察到的文件内容关键点

  1. 命令文件结构：每个命令文件都包含frontmatter（描述、handoffs）和执行步骤（Outline）
  2. 模板文件：使用占位符（如 [FEATURE_NAME]、$ARGUMENTS）等待填充
  3. 脚本功能：处理Git分支、文件路径解析、JSON输出等基础设施任务
  4. 工作流连接：命令之间通过handoffs定义了流转关系

  需要澄清的问题

  在继续深入分析之前，我想确认以下信息：

  1. 您最关心的是哪个方面？
    - 命令的整体工作流程和执行顺序？
    - 如何修改模板内容？
    - 如何调整命令行为？
    - 脚本如何协同工作？
  2. 您计划进行什么样的调整？
    - 修改模板格式或内容？
    - 调整命令执行逻辑？
    - 添加新的检查或验证？
    - 改变文件组织结构？
  3. 您的使用场景是？
    - 单人开发还是团队协作？
    - 特定编程语言或技术栈？
    - 是否需要与特定工具集成？

  ---
  下一步：

  1. 输入 ENTER INNOVATE MODE 进入下一模式
  2. 继续澄清需求，可复制：进入下一模式前，还有疑问吗？
```